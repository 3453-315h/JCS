using HtmlAgilityPack;
using System;
using System.Net;

namespace JCS_1._0.Http
{
    static class ExploitViewer
    {
        public static string GrabInfo(this string link)
        {
            using (WebClient wb = new WebClient())
            {
                try
                {
                    wb.Headers.Add("user-agent", " Mozilla/5.0 (Windows NT 6.1; WOW64; rv:25.0) Gecko/20100101 Firefox/25.0");

                    if (link.Contains("exploit-db.com"))
                    {
                        link = link.Replace("exploits", "download");
                        return wb.DownloadString(link);
                    }

                    HtmlDocument doc = new HtmlDocument();
                    doc.LoadHtml(wb.DownloadString(link));
                    foreach (HtmlNode node in doc.DocumentNode.SelectNodes("//a[@href]"))
                    {
                        string value = node.GetAttributeValue("href", string.Empty);
                        if (value.Contains("/files/download"))
                        {
                            return wb.DownloadString(string.Format("https://packetstormsecurity.com{0}", value));
                        }
                    }
                    return null;
                }
                catch (Exception ex)
                {
                    return ex.Message;
                }
            }

        }
    }
}
